<!DOCTYPE html>
<html lang="ru">
<head>
  {% load static %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}DÉSSO FLOWERS{% endblock %}</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="{% static 'base_page/css/base.css' %}">
  <link rel="stylesheet" href="{% static 'base_page/css/header.css' %}">
  {% block extra_css %}{% endblock %}
</head>
<body>
  {% block header %}
    <header class="site-header" id="siteHeader">
      <div class="header-top">
        <a href="/" class="logo">DÉSSO FLOWERS ®</a>
      </div>
      <div class="header-bottom" id="headerBottom">
        <nav class="nav-row">
          <a href="{% url 'catalog_page' %}">Коллекции</a>
          <a href="#">Клубника</a>
          <a href="#">Магазины</a>
          <a href="#">Контакты</a>
        </nav>
      </div>

    </header>
  {% endblock header %}

  {% block hero %}
      <!-- HERO -->
  <section class="hero" id="hero">
    <div class="slider" id="heroSlider">

      {% for slide in slides %}
        <section class="slide" data-idx="{{ forloop.counter0 }}">
          <video autoplay muted playsinline {% if slide.poster %}poster="{{ slide.poster.url }}"{% endif %}>
            <source src="{{ slide.video.url }}" type="video/mp4">
          </video>
          <div class="gradient"></div>
          <div class="caption">
            {% if slide.kicker %}<div class="kicker">{{ slide.kicker }}</div>{% endif %}
            <h1 class="title">{{ slide.title }}</h1>
            {% if slide.subtitle %}<p class="subtitle">{{ slide.subtitle }}</p>{% endif %}
            {% if slide.cta_text %}
              <a href="{{ slide.cta_link }}" class="cta">{{ slide.cta_text }}</a>
            {% endif %}
          </div>
        </section>
      {% endfor %}

    </div>

      <div class="nav-zones" aria-hidden="true">
        <button class="prev" id="heroPrev"></button>
        <button class="next" id="heroNext"></button>
      </div>
      <div class="dots" id="heroDots"></div>
    </section>
  {% endblock hero %}


  {% block stories %}
    <!-- ===== STORIES (preview circles) ===== -->
    <section class="stories" aria-label="Сториз">
      <div class="container">
        <div class="track">
          {% for story in stories %}
            <button class="story" data-story="{{ story.id }}" type="button">
              <div class="ring">
                <div class="circle">
                  <div class="inner">
                    <img src="{{ story.cover_image.url }}" alt="{{ story.label }}">
                  </div>
                </div>
              </div>
              <div class="label">{{ story.label }}</div>
            </button>
          {% endfor %}
        </div>
      </div>
    </section>


    <!-- ===== STORIES MODAL ===== -->
    <div class="stories-modal" id="storiesModal" aria-hidden="true">
      <div class="stories-backdrop"></div>

      <div class="stories-frame" role="dialog" aria-modal="true" aria-label="Истории">
        <div class="stories-progress" id="storiesProgress"></div>
        <div class="stories-media" id="storiesMedia"></div>
        <button class="stories-zone left"  id="storiesPrev" aria-label="Назад"></button>
        <button class="stories-zone right" id="storiesNext" aria-label="Дальше"></button>
        <button class="stories-close" id="storiesClose" aria-label="Закрыть">✕</button>
      </div>
    </div>
  {% endblock stories %}

    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- ===== FOOTER ===== -->
  <footer>
    <div class="container foot">
      <div>
        <h4>DESSO</h4>
        <p>Источник гормонов счастья. Цветы и подарки 24/7.</p>
      </div>
      <div>
        <h4>Навигация</h4>
        <ul>
          <li><a href="#">Каталог</a></li>
          <li><a href="#">Доставка</a></li>
          <li><a href="#">Контакты</a></li>
        </ul>
      </div>
      <div>
        <h4>Компания</h4>
        <ul>
          <li><a href="#">О нас</a></li>
          <li><a href="#">Вакансии</a></li>
          <li><a href="#">Отзывы</a></li>
        </ul>
      </div>
      <div>
        <h4>Соцсети</h4>
        <ul>
          <li><a href="#">Instagram</a></li>
          <li><a href="#">WhatsApp</a></li>
          <li><a href="#">Telegram</a></li>
        </ul>
      </div>
    </div>
    <div class="copyright">{{ now|date:"Y" }} DESSO Flowers ® </div>
  </footer>

  <!-- Скрипты страницы -->
  {% block scripts %}
  <script src="{% static 'base_page/js/hero.js' %}"></script>
  <script src="{% static 'base_page/js/header.js' %}"></script>
  <script>
    const STORIES = {
      {% for story in stories %}
        "{{ story.id }}": [
          {% for item in story.items.all %} 
            {
              type: "{{ item.media_type }}",
              src: "{{ item.file.url }}",
              {% if item.poster %}poster: "{{ item.poster.url }}",{% endif %}
              {% if item.duration %}duration: {{ item.duration }},{% endif %}
            },
          {% endfor %}
        ],
      {% endfor %}
    };
  </script>
  <script async src="{% static 'base_page/js/stories.js' %}"></script>
  {% endblock %}
</body>
</html>
