{% extends "base.html" %}
{% load static %}

{% block title %}Каталог — DÉSSO FLOWERS{% endblock %}

{% block content %}

  <!-- ===== STORIES (preview circles) ===== -->
  <section class="stories" aria-label="Сториз">
    <div class="container">
      <div class="track">
        {% for story in stories %}
          <button class="story" data-story="{{ story.id }}" type="button">
            <div class="ring">
              <div class="circle">
                <div class="inner">
                  <img src="{{ story.cover_image.url }}" alt="{{ story.label }}">
                </div>
              </div>
            </div>
            <div class="label">{{ story.label }}</div>
          </button>
        {% endfor %}
      </div>
    </div>
  </section>


  <!-- ===== STORIES MODAL ===== -->
  <div class="stories-modal" id="storiesModal" aria-hidden="true">
    <div class="stories-backdrop"></div>

    <div class="stories-frame" role="dialog" aria-modal="true" aria-label="Истории">
      <div class="stories-progress" id="storiesProgress"></div>
      <div class="stories-media" id="storiesMedia"></div>
      <button class="stories-zone left"  id="storiesPrev" aria-label="Назад"></button>
      <button class="stories-zone right" id="storiesNext" aria-label="Дальше"></button>
      <button class="stories-close" id="storiesClose" aria-label="Закрыть">✕</button>
    </div>
  </div>


  <!-- ===== BANNERS ===== -->
  {% for banner in banners %}
    <div class="container banner">
      <a href="{{ banner.link }}" target="_blank" rel="noopener" class="banner-link">
        <img src="{{ banner.image.url }}" alt="{{ banner.title }}">
      </a>
      <div class="inner">
        <h3>{{ banner.title }}</h3>
        {% if banner.link %}
          <a href="{{ banner.link }}" class="cta">Перейти</a>
        {% endif %}
      </div>
    </div>
  {% endfor %}


  <!-- ===== FOOTER ===== -->
  <footer>
    <div class="container foot">
      <div>
        <h4>DESSO</h4>
        <p>Источник гормонов счастья. Цветы и подарки 24/7.</p>
      </div>
      <div>
        <h4>Навигация</h4>
        <ul>
          <li><a href="#">Каталог</a></li>
          <li><a href="#">Доставка</a></li>
          <li><a href="#">Контакты</a></li>
        </ul>
      </div>
      <div>
        <h4>Компания</h4>
        <ul>
          <li><a href="#">О нас</a></li>
          <li><a href="#">Вакансии</a></li>
          <li><a href="#">Отзывы</a></li>
        </ul>
      </div>
      <div>
        <h4>Соцсети</h4>
        <ul>
          <li><a href="#">Instagram</a></li>
          <li><a href="#">WhatsApp</a></li>
          <li><a href="#">Telegram</a></li>
        </ul>
      </div>
    </div>
    <div class="copyright">{{ now|date:"Y" }} DESSO Flowers ® </div>
  </footer>
{% endblock %}


{% block scripts %}
  <script src="{% static 'main_page/js/hero.js' %}"></script>
  <script src="{% static 'main_page/js/header.js' %}"></script>
  <script>
    const STORIES = {
      {% for story in stories %}
        "{{ story.id }}": [
          {% for item in story.items.all %} 
            {
              type: "{{ item.media_type }}",
              src: "{{ item.file.url }}",
              {% if item.poster %}poster: "{{ item.poster.url }}",{% endif %}
              {% if item.duration %}duration: {{ item.duration }},{% endif %}
            },
          {% endfor %}
        ],
      {% endfor %}
    };
  </script>
  <script src="{% static 'main_page/js/stories.js' %}"></script>
{% endblock %}
